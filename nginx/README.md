# Nginx Configuration

## Описание
Конфигурация Nginx сервера для Shop21. Выполняет роль обратного прокси и балансировщика нагрузки.

## Структура
- `Dockerfile` - файл для сборки Docker образа Nginx
- `nginx.conf` - основной конфигурационный файл Nginx
- `ssl/` - SSL сертификаты и скрипты
  - `shop21.crt` - SSL сертификат
  - `shop21.key` - приватный ключ SSL
  - `create-domain.bash` - скрипт создания SSL сертификата
  - `delete-domain.bash` - скрипт удаления SSL сертификата
- `static/` - статические файлы
  - `index.html` - статическая страница
  - `kek.png` - изображение

## Функциональность

### Балансировка нагрузки
Nginx распределяет входящие запросы между тремя экземплярами API:
- `shop21api:8080` (основной)
- `shop21api_read1:8080` (реплика чтения 1)
- `shop21api_read2:8080` (реплика чтения 2)

### SSL/TLS
Настроена поддержка HTTPS с использованием самоподписанных сертификатов.

### Порты
- **80** (10006 на хосте) - HTTP
- **443** (10007 на хосте) - HTTPS

## Создание SSL сертификатов

### Создание нового сертификата
```bash
cd ssl
./create-domain.bash
```

### Удаление сертификата
```bash
cd ssl
./delete-domain.bash
```

## Docker

### Сборка образа
```bash
docker build -t shop21-nginx .
```

### Запуск через Docker Compose
```bash
cd ..
docker-compose up -d nginx
```

## Конфигурация
Основная конфигурация находится в `nginx.conf`. При изменении конфигурации необходимо перезапустить контейнер:
```bash
docker-compose restart nginx
```

## Логи
Просмотр логов Nginx:
```bash
docker-compose logs -f nginx
```

## Upstream серверы
Nginx проксирует запросы к:
- **API серверам** - балансировка между тремя экземплярами
- **UI** - прямое проксирование к Vue приложению
- **PgAdmin** - доступ к веб-интерфейсу PostgreSQL
